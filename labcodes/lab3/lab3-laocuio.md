# Lab3 report
## 列出你认为本实验中重要的知识点，以及与对应的OS原理中的知识点
> 虚拟内存的Page Fault异常处理实现；页替换算法
  
## 列出你认为OS原理中很重要，但在实验中没有对应上的知识点
> 无
  
## 练习0：填写已有实验
  
> meld手动修改
  
## 练习1：给未被映射的地址映射上物理页
  
> 实验指导书的步骤很详细，一步步操作即可。
>> 与参考答案的差别：map_swappable()函数中的swap_in参数不知道起何作用，在FIFO算法中并未用到。

## 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处。
> 当一个PTE用来描述一般意义上的物理页时，显然它应该维护各种权限和映射关系，以及应该有PTE_ P标记；但当它用来描述一个被置换出去的物理页时，它被用来维护该物理页与 swap 磁盘上扇区的映射关系，并且该 PTE 不应该由 MMU 将它解释成物理页映射(即没有 PTE_ P 标记)，与此同时对应的权限则交由 mm_struct 来维护，当对位于该页的内存地址进行访问的时候，必然导致 page fault，然后ucore能够根据 PTE 描述的 swap 项将相应的物理页重新建立起来，并根据虚存所描述的权限重新设置好 PTE 使得内存访问能够继续正常进行。该PTE的最低位--present位应该为0 （即 PTE _P 标记为空，表示虚实地址映射关系不存在），接下来的7位暂时保留，可以用作各种扩展；而原来用来表示页帧号的高24位地址，恰好可以用来表示此页在硬盘上的起始扇区的位置（其从第几个扇区开始）。为了在页表项中区别 0 和 swap 分区的映射，将 swap 分区的一个 page 空出来不用，也就是说一个高24位不为0，而最低位为0的PTE表示了一个放在硬盘上的页的起始扇区号。
  
## 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？
> 首先页访问异常也是一种异常，所以针对一般异常的硬件处理操作是必须要做的，即CPU在当前内核栈保存当前被打断的程序现场，即依次压入当前被打断程序使用的EFLAGS，CS，EIP，errorCode；由于页访问异常的中断号是0xE，CPU把异常中断号0xE对应的中断服务例程的地址（vectors.S中的标号vector14处）加载到CS和EIP寄存器中，开始执行中断服务例程。产生页访问异常后，CPU把引起页访问异常的线性地址装到寄存器CR2中，并给出了出错码errorCode，说明了页访问异常的类型。
  
## 练习2：补充完成基于FIFO的页面替换算法
 
> 实验指导书的步骤很详细，一步步操作即可。
>> 与参考答案的差别：参考答案在实现的时候加入了很多assert()降低调试难度，其他基本相同。

#### 如果要在ucore上实现"extended clock页替换算法"请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。并需要回答如下问题：需要被换出的页的特征是什么？在ucore中如何判断具有这样特征的页？何时进行换入和换出操作？

